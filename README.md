# Завдання GIS: Google Sheets → ArcGIS Online

## Що робить цей скрипт
- Завантажує таблицю Google Sheets (експорт у CSV).
- Нормалізує та розгортає рядки: кожне ненульове поле `Значення 1–10` породжує окремі рядки з мітками `1`/`0`.
- Надсилає отримані точки (геометрія з полів `long`/`lat`) у розміщений шар об'єктів ArcGIS Online (Hosted Feature Layer).

## Налаштування
1. Створіть і активуйте віртуальне середовище та встановіть залежності:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

2. Створіть `.env` з прикладу та заповніть значення (скрипт завантажує його автоматично):

```bash
cp .env.example .env
```

3. За потреби можна експортувати змінні середовища у вашому shell замість використання `.env`.

## Обов'язкові змінні середовища
- `SHEET_ID` – ідентифікатор Google Sheets (з URL між `/d/` і `/edit`)
- `SHEET_GID` – `gid` вкладки аркуша (з URL `#gid=`; зазвичай `0` для першої вкладки)
- `ARCGIS_USERNAME` – ім'я користувача ArcGIS Online
- `ARCGIS_PASSWORD` – пароль ArcGIS Online
- `ARCGIS_ITEM_ID` – id елемента Hosted Feature Layer (приклад: `0ebc20bdfe494cfa94cdb02eb8c00524`)

Необов'язково:
- `ARCGIS_URL` – адреса порталу (за замовчуванням: `https://www.arcgis.com`)
- `TRUNCATE_BEFORE_LOAD` – `true`, щоб очистити шар перед вставкою

## Запуск
З активованим віртуальним середовищем (або з системним Python, якщо налаштовано):

```bash
python update_layer.py
```

Або передайте значення явно:

```bash
python update_layer.py --sheet-id <SHEET_ID> --sheet-gid <SHEET_GID> \
   --arcgis-username <USER> --arcgis-password '<PASSWORD>' --item-id <ITEM_ID>
```

## Нотатки та усунення проблем
- Дати парсяться за допомогою `dateutil` (увімкнено парсинг з пріоритетом дня). За можливості використовуйте формат `DD.MM.YYYY`.
- Координати підтримують коми як десяткові роздільники (наприклад `30,252525`).
- Скрипт спочатку пробує `utf-8-sig`, а потім переходить на `cp1251` під час читання CSV з Google Sheets.
- Якщо з'являється повідомлення "Google Sheets returned HTML instead of CSV", переконайтеся, що аркуш відкритий для перегляду (Anyone with the link can view), або перевірте `SHEET_ID`/`SHEET_GID`.
- Якщо заголовки виглядають пошкодженими (кодування), відкрийте аркуш як CSV у браузері та переконайтеся, що назви колонок точно збігаються:
   `Дата, Область, Місто, Значення 1, ..., Значення 10, long, lat`.
- Для налагодження без облікових даних ArcGIS задайте `SHEET_ID`/`SHEET_GID` для публічного тестового аркуша — скрипт виведе перетворені рядки перед спробою завантаження.

